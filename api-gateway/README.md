# API Gateway (KrakenD)

## üìñ –û–±–∑–æ—Ä

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ (Entry Point) –¥–ª—è –≤—Å–µ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Task Manager. –û–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –±–∞–∑–µ [KrakenD](https://www.krakend.io/) ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ API Gateway.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
1. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (Routing):** –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º (Auth, Task, User, Submission).
2. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `no-op` –¥–ª—è –ø—Ä—è–º–æ–π –ø—Ä–æ–∫—Å–∏-–ø–µ—Ä–µ–¥–∞—á–∏).
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (CORS):** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏ Cross-Origin Resource Sharing.
4. **–ú–∞–Ω–∏–ø—É–ª—è—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏:** –ü—Ä–æ–±—Ä–æ—Å —Ç–æ–∫–µ–Ω–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
5. **–°–æ–∫—Ä—ã—Ç–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –ö–ª–∏–µ–Ω—Ç –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ –ø–æ—Ä—Ç–µ `8000`, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ —Å–∫—Ä—ã—Ç–∞ (–ø–æ—Ä—Ç—ã 8081, 8082 –∏ —Ç.–¥. –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑–≤–Ω–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ).

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `krakend.json`.

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **Port:** `8000`
- **Version:** `3` (–í–µ—Ä—Å–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ KrakenD)
- **Logging:** –í–∫–ª—é—á–µ–Ω —É—Ä–æ–≤–µ–Ω—å `DEBUG` —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[KRAKEND]`.

### CORS (Cross-Origin Resource Sharing)
–ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Frontend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º:
```json
"github_com/devopsfaith/krakend-cors": {
  "allow_origins": ["http://localhost:3000", "http://127.0.0.1:3000"],
  "allow_methods": ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"],
  "allow_headers": ["Origin", "Content-Type", "Authorization", "Accept", "X-Requested-With"],
  "allow_credentials": true,
  "max_age": "12h"
}
```

---

## üõ£Ô∏è –ú–∞—Ä—à—Ä—É—Ç—ã (Endpoints)

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ—Å—Ç—É–ø–∞—é—Ç –Ω–∞ `http://localhost:8000`. KrakenD –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ –Ω–∏–∂–µ.

### üîê Auth Service (–°–µ—Ä–≤–∏—Å –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
*Backend Host:* `http://auth-service:8081`

| Endpoint Gateway | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | Backend Endpoint | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|------------------|-------|----------|------------------|-------------|
| `/register`      | POST  | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | `/register`      | –ü—Ä—è–º–æ–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `/login`         | POST  | –í—Ö–æ–¥ | `/login`         | –ü—Ä—è–º–æ–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `/logout`        | POST  | –í—ã—Ö–æ–¥ | `/logout`        | –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∏ `Authorization`, `Content-Type` |
| `/refresh`       | POST  | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ | `/refresh` | –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∏ `Authorization`, `Content-Type` |
| `/health`        | GET   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è | `/health`        | - |

### üìã Task Service (–°–µ—Ä–≤–∏—Å –ó–∞–¥–∞—á)
*Backend Host:* `http://task-service:8082`

| Endpoint Gateway | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | Backend Endpoint | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|------------------|-------|----------|------------------|-------------|
| `/tasks`         | GET   | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á | `/tasks` | –ü—Ä–æ–±—Ä–æ—Å `Authorization` |
| `/tasks`         | POST  | –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É | `/tasks` | –ü—Ä–æ–±—Ä–æ—Å `Authorization` |
| `/tasks/{taskId}`| GET   | –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É –ø–æ ID | `/tasks/{taskId}` | - |
| `/tasks/{taskId}`| PUT   | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É | `/tasks/{taskId}` | - |
| `/tasks/{taskId}`| DELETE| –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É | `/tasks/{taskId}` | - |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{taskId}`) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –±—ç–∫–µ–Ω–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### üìÆ Task Submission Service (–°–µ—Ä–≤–∏—Å –°–¥–∞—á–∏ –†–µ—à–µ–Ω–∏–π)
*Backend Host:* `http://task-submission-service:8083`

| Endpoint Gateway | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | Backend Endpoint |
|------------------|-------|----------|------------------|
| `/submissions`   | POST  | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ | `/submissions` |
| `/submissions/{id}`| GET | –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ | `/submissions/{id}` |

### üë§ User Service (–°–µ—Ä–≤–∏—Å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
*Backend Host:* `http://user-service:8084`

| Endpoint Gateway | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | Backend Endpoint |
|------------------|-------|----------|------------------|
| `/profile`       | GET   | –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å | `/profile` |
| `/profile`       | PUT   | –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å | `/profile` |

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### Encoding: `no-op`
–í–æ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `output_encoding: "no-op"` –∏ `encoding: "no-op"`.
–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **KrakenD –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞**. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –ø—Ä–æ–∫—Å–∏.
*   **–ü–ª—é—Å:** –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö (JSON, XML, Binary).
*   **–ú–∏–Ω—É—Å:** –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã–º–∏ KrakenD (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ). –í –¥–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è.

### –°–µ—Ç—å
–°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–π –∂–µ Docker-—Å–µ—Ç–∏, —á—Ç–æ –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (`app-network`), —á—Ç–æ–±—ã –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–∏–º –ø–æ –∏–º–µ–Ω–∞–º —Ö–æ—Å—Ç–æ–≤ (`auth-service`, `task-service` –∏ —Ç.–¥.).

---

## üöÄ –ó–∞–ø—É—Å–∫

–°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ —á–∞—Å—Ç—å `docker-compose`.

```yaml
  api-gateway:
    image: krakend:latest
    ports:
      - "8000:8000"
    volumes:
      - ./api-gateway/krakend.json:/etc/krakend/krakend.json
    depends_on:
      - auth-service
      - task-service
    networks:
      - app-network
```

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
`krakend check -c krakend.json` (—Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ KrakenD, –≤ –¥–æ–∫–µ—Ä–µ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

---

## üîç –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f api-gateway`.
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ gateway.
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–≤–∫–ª–∞–¥–∫–∞ Network).

